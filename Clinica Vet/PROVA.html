<html>
<body>
<?php include_once"header.php"?>

<!--menu di navigazione-->
<?php include_once"navbar.php"?>
<script>
        	function check() {
    			if (document.getElementById('password').value == document.getElementById('controlPassword').value){
					document.getElementById('pswMessage').innerHTML = '';
					document.getElementById('submit').disabled = false;
				}
    			else {
    				document.getElementById('pswMessage').innerHTML = 'Attenzione! Le password devono coincidere';
        			document.getElementById('submit').disabled = true;
    			}
			}
        </script>
<?php
              $access = new DBAccess();
              $connection = $access->openDBConnection();
              
              if(!$connection) die("Errore nella connessione");
              
              else{
              	
              	
            	$messaggioErrore = "";
		        if (isset($_REQUEST['email'])){
                  	if($_REQUEST['password'] != $_REQUEST['controlPassword']){
                    	$messaggioErrore .= "ATTENZIONE! Le due password devono coincidere.";
                    }
		            else{
						$result = $access->insertUser($_REQUEST['email'],$_REQUEST['name'],$_REQUEST['surname'],$_REQUEST['telefono'],$_REQUEST['password']);
                		if($result){
                			$email = stripslashes($_REQUEST['email']);
                			$email = mysqli_real_escape_string($access->connessione,$email);
                  			header("Location: RegistrazioneEffettuata.php");
                		}	
					}
              	}
	          	?>
<script type="text/javascript" src="js/script.js"></script>
<form name="registration" action="<?php echo $_SERVER [ 'PHP_SELF']; ?>" method="post" onsubmit="return validateInsertRegistrati()" >
					<div id="errorAdd"></div>
                    <p><label for="name">Nome: </label> </p> <fieldset><input id="name" type="text" name="name" placeholder="Nome"  /></fieldset>
                    	
                    <p><label for="surname">Cognome: </label> </p> <fieldset><input id="surname" type="text" name="surname" placeholder="Cognome"  /></fieldset>
          	    		
                    <p><label for="telefono">Telefono: </label></p> <fieldset><input id="telefono" type="text" name="telefono" placeholder="Telefono" required /></fieldset>
          	    		
                    <p><label for="email">Indirizzo <span xml:lang="en" lang="en">e-mail:</span></label></p> <fieldset><input id="email" type="email" name="email" placeholder="Email" required /></fieldset>
	           	    	
                    <p><span xml:lang="en" lang="en"><label for="password">Password: </label></span> </p> <fieldset><input type="password" name="password" id="password" onkeyup="check();" placeholder="Password"  /></fieldset>
                    
                    <p><label for="controlPassword">Reinserisci la <span xml:lang="en" lang="en">password: </span></label> </p> <fieldset><input id="cpassword" type="password" name="controlPassword" onkeyup="check();" placeholder="Password"  /></fieldset>
                    	<h2 class="message" id="pswMessage"></h2>
                    	
		            	<p><button type="submit" name="submit" id="submit" disabled>Registrati</button></p>
	            	</form>
					
</body>
</html>